---
import { ClipboardList, Search, FileText, Banknote, Map, Box, ShieldCheck, Truck } from "@lucide/astro";
import { useTranslations, type Lang } from "@/i18n";

interface Props {
  lang: Lang;
}

const { lang } = Astro.props;
const t = useTranslations(lang);

const topRow = [
  { icon: ClipboardList, title: t("howWeWork.step1") },
  { icon: Search, title: t("howWeWork.step2") },
  { icon: FileText, title: t("howWeWork.step3") },
  { icon: Banknote, title: t("howWeWork.step4") },
];

const bottomRow = [
  { icon: Truck, title: t("howWeWork.step8") },
  { icon: ShieldCheck, title: t("howWeWork.step7") },
  { icon: Box, title: t("howWeWork.step6") },
  { icon: Map, title: t("howWeWork.step5") },
];
---

<section class="py-20 bg-white">
  <div class="container">
    <div class="max-w-2xl mb-16">
      <h2 class="text-3xl md:text-5xl font-bold text-primary mb-6">{t("howWeWork.title")}</h2>
      <p class="text-lg md:text-xl">{t("howWeWork.subtitle")}</p>
    </div>

    <!-- Steps flow -->
    <div class="hww-steps">
      <!-- Top row: 4 steps left to right -->
      <div class="hww-row hww-row--top">
        {topRow.map((step, i) => (
          <div class="hww-step">
            <div class="hww-icon">
              <step.icon class="w-7 h-7 text-primary" />
            </div>
            {i < topRow.length - 1 && (
              <div class="hww-arrow hww-arrow--right" aria-hidden="true">
                <svg viewBox="0 0 12 8" fill="none"><path d="M8 1l3 3-3 3" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg>
              </div>
            )}
            <p class="hww-label">{step.title}</p>
          </div>
        ))}
      </div>

      <!-- Vertical connector on the right side -->
      <div class="hww-connector-down" aria-hidden="true"></div>

      <!-- Bottom row: 4 steps right to left (reversed visually) -->
      <div class="hww-row hww-row--bottom">
        {bottomRow.map((step, i) => (
          <div class="hww-step">
            <div class="hww-icon">
              <step.icon class="w-7 h-7 text-primary" />
            </div>
            {i < bottomRow.length - 1 && (
              <div class="hww-arrow hww-arrow--left" aria-hidden="true">
                <svg viewBox="0 0 12 8" fill="none"><path d="M4 1L1 4l3 3" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg>
              </div>
            )}
            <p class="hww-label">{step.title}</p>
          </div>
        ))}
      </div>
    </div>

    <!-- Mobile steps (single column) -->
    <div class="hww-mobile">
      {[...topRow, ...bottomRow.slice().reverse()].map((step, i, arr) => (
        <div class="hww-mobile-step">
          <div class="hww-mobile-icon">
            <step.icon class="w-6 h-6 text-primary" />
          </div>
          <p class="hww-mobile-label">{step.title}</p>
          {i < arr.length - 1 && (
            <div class="hww-mobile-connector" aria-hidden="true"></div>
          )}
        </div>
      ))}
    </div>

  
    <div class="grid lg:grid-cols-[280px_1px_1fr] mt-10 md:mt-20 gap-8 items-start">
      <div class="text-white rounded-2xl p-6"  style="background: linear-gradient(135deg, #916a2a 0%, #936C2C 51%, #B79647 75%, #DBD286 100%);">
        <h3 class="text-2xl font-bold mb-6">{t("howWeWork.contactUs")}</h3>
        <div class="mb-5">
          <p class="font-semibold text-[#d4ff80] mb-1">{t("howWeWork.email")}</p>
          <p class="text-white font-medium">@pochta</p>
        </div>
        <div>
          <p class="font-semibold text-[#d4ff80] mb-1">{t("howWeWork.phone")}</p>
          <p class="text-white font-medium">+ 999 99 999 99 99</p>
        </div>
      </div>

      <!-- Divider -->
      <div class="hidden lg:block w-px bg-primary/30 self-stretch"></div>

      <!-- Request a Consultation -->
      <div>
        <h3 class="text-2xl md:text-3xl font-bold mb-3 border-b-2 border-primary inline-block pb-1">{t("howWeWork.requestConsultation")}</h3>
        <p class="mb-6">{t("howWeWork.requestConsultationDesc")}</p>
        <form class="space-y-4">
          <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
            <input type="text" placeholder={t("howWeWork.yourName")} class="border border-gray-300 rounded-lg px-4 py-3 text-sm focus:outline-none focus:border-primary" />
            <input type="text" placeholder={t("howWeWork.company")} class="border border-gray-300 rounded-lg px-4 py-3 text-sm focus:outline-none focus:border-primary" />
            <input type="tel" placeholder={t("howWeWork.phonePlaceholder")} class="border border-gray-300 rounded-lg px-4 py-3 text-sm focus:outline-none focus:border-primary" />
          </div>
          <textarea placeholder={t("howWeWork.message")} rows="3" class="w-full border border-gray-300 rounded-lg px-4 py-3 text-sm focus:outline-none focus:border-primary resize-none"></textarea>
          <button type="submit" class="button text-white font-semibold px-8 py-3 rounded-lg hover:opacity-90 transition-opacity">
            {t("howWeWork.sendRequest")}
          </button>
        </form>
      </div>
    </div>
  </div>
</section>

<style>
  /* ── Desktop steps grid ── */
  .hww-steps {
    display: none;
  }

  @media (min-width: 1024px) {
    .hww-steps {
      display: block;
    }
    .hww-mobile {
      display: none;
    }
  }

  .hww-row {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 0;
    position: relative;
  }

  .hww-step {
    display: flex;
    flex-direction: column;
    align-items: flex-start;
    position: relative;
    padding-right: 2rem;
  }

  .hww-icon {
    width: 56px;
    height: 56px;
    border-radius: 50%;
    border: 2px dashed #916a2a;
    background: #faf6ee;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
    position: relative;
    z-index: 2;
  }

  .hww-label {
    margin-top: 0.75rem;
    font-size: 0.875rem;
    line-height: 1.4;
    color: #916a2a;
    font-weight: 500;
    
  }

  /* ── Horizontal arrows ── */
  .hww-arrow {
    position: absolute;
    top: 28px;
    height: 0;
    border-top: 2px dashed #c4a265;
    z-index: 1;
    display: flex;
    align-items: center;
  }

  .hww-arrow svg {
    width: 12px;
    height: 8px;
    color: #c4a265;
    flex-shrink: 0;
  }

  .hww-arrow--right {
    left: 64px;
    right: -8px;
  }

  .hww-arrow--right svg {
    position: absolute;
    right: -2px;
    top: -4px;
  }

  .hww-arrow--left {
    left: 64px;
    right: -8px;
  }

  .hww-arrow--left svg {
    position: absolute;
    left: -2px;
    top: -4px;
  }

  /* ── Vertical connector (right side, between rows) ── */
  .hww-connector-down {
    width: 0;
    height: 80px;
    border-left: 2px dashed #c4a265;
    margin-left: auto;
    margin-right: calc(25% - 61px + 2rem);
    position: relative;
    transform: translateY(-15%);
  }

  .hww-row--bottom {
    margin-top: 0;
  }

  .hww-row--bottom .hww-step {
    direction: ltr;
  }

  /* ── Mobile layout ── */
  .hww-mobile {
    display: flex;
    flex-direction: column;
    align-items: flex-start;
    gap: 0;
  }

  @media (min-width: 1024px) {
    .hww-mobile {
      display: none;
    }
  }

  .hww-mobile-step {
    display: flex;
    align-items: center;
    gap: 1rem;
    position: relative;
    padding-bottom: 2rem;
  }

  .hww-mobile-step:last-child {
    padding-bottom: 0;
  }

  .hww-mobile-icon {
    width: 44px;
    height: 44px;
    min-width: 44px;
    border-radius: 50%;
    border: 2px dashed #916a2a;
    background: #faf6ee;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .hww-mobile-label {
    font-size: 0.875rem;
    color: #916a2a;
    font-weight: 500;
  }

  .hww-mobile-connector {
    position: absolute;
    left: 21px;
    top: 46px;
    bottom: 0;
    width: 0;
    border-left: 2px dashed #c4a265;
  }
</style>
